<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>{{name}}</title>
        <script src='{{benchmarkjsURL}}'></script>
        <script>
        var name = document.getElementsByTagName('title')[0].innerHTML,
            autoExecute = (!Boolean(window.location.search.match(/auto=false/g))),
            readyCount = {{readyCount}},
            suite;

        try { console.log(); }
        catch (e) { window.console = { log: function() {} }; }

        function ready () {
            // Have all the loaders finished?
            if (--readyCount === 0) {

                // First, populate <body>
                resetBody();

                // Next, add the tests
                addTests();

                // and now execute the tests
                executeTests();
            }
        }

        // Create the Benchmark.js test suite
        suite = new Benchmark.Suite({

            // The name of the suite
            name: name,

            // called when the suite starts running
            onStart: function (e) {
                console.log('Executing ' + suite.options.name + ' (' + suite.length + ' tests)...');
            },

            // called between running benchmarks
            onCycle: function (e) {
                console.log(e.target.toString());
            },

            // called when aborted
            onAbort: function (e) {
                console.log('Abort');
            },

            // called when a test errors
            onError: function (e) {
                throw new Error(e.target.error.message)
            },

            // called when reset
            onReset: function (e) {
                console.log('Reset');
            },

            // called when the suite completes running
            onComplete: function (e) {
                var tests = [], test;

                while (test = suite.shift()) {
                    tests.push(test);
                }

                console.log('-COMPLETE-');
            }
        });

        function resetBody() {
            var body = document.getElementsByTagName('body')[0];
            body.innerHTML = document.getElementById('test-html').innerHTML;
        }

        function addTests () {
            {{#each tests}}
            // Test {{@index}}
            suite.add({
                name: '{{this.name}}',
                defer: {{this.defer}},
                setup: {{{this.setup}}},
                teardown: {{{this.teardown}}},
                fn: {{{this.fn}}}
            });
            {{/each}}
        }

        function executeTests () {
            suite.run({ async: true });
        }

        ready();
        </script>

        {{{bottomHTML}}}

        <script type="text/x-handlebars-template" id="test-html">
            {{{html}}}
        </script>
    </head>

    <body><!-- Intentionally blank --></body>
</html>
